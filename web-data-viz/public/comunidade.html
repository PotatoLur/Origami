<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comunidade</title>
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <header>
        <nav class="navbar_esquerda">
            <a href="index.html"><img class="logo" src="./img/logo.png" alt="logo"></a>
            <li>
                <a href="index.html">Hist√≥ria</a>
            </li>
            <li class="agora">
                <a href="comunidade.html">Comunidade</a>
            </li>
            <li>
                <a href="autor.html">Autor</a>
            </li>
            <li id="navbar_quiz">
                <a href="quiz.html">Quiz</a>
            </li>
        </nav>
        <nav class="navbar_direita">
            <li>
                <a href="" id="navbar_sair">Sair</a>
            </li>
            <li>
                <a href="cadastro.html" id="navbar_cadastro">Cadastro</a>
            </li>
            <li>
                <a href="login.html" id="navbar_login">Login</a>
            </li>
        </nav>
    </header>

    <main class="comunidade">
        <h1>Maior comunidade de Origami do Mundo</h1>
        <div class="sem_login" id="sem_login">
            <div class="diferente_tipo">
                <p>Seja bem vindo a galeria dos origamis, aproveite essa pequena amostra feita por alguns membros da
                    comunidade.</p>
                <p>Se cadastre para ver mais:</p>
                <button onclick="irParaCadastro()">Cadastrar</button>
            </div>
            <div class="exemplo">
                <img class="comunidade_img" src="./img/1.jpeg" alt="">
                <div class="texto">
                    <p>Autor: Guilherme Aoki</p>
                    <p>Tipo: Origami 3D</p>
                    <p>Nome: 3D Origami Swan</p>
                </div>
            </div>
            <div class="exemplo">
                <div class="texto">
                    <p>Autor: Guilherme Aoki</p>
                    <p>Tipo: Tradicional/Outros</p>
                    <p>Nome: Polygonal Cubes and Stars</p>
                </div>
                <div class="slides">
                    <div class="comunidade_img">
                        <img src="./img/2.jpeg" alt="">
                    </div>
                </div>
            </div>
            <div class="diferente_tipo">
                <h2>Origami World</h2>
                <p>Aqui voc√™ vai encontrar todos esses estilos de origami reunidos em um s√≥ lugar, com cria√ß√µes
                    incr√≠veis de pessoas apaixonadas pela arte de dobrar papel. Explore, descubra, inspire-se e
                    compartilhe suas pr√≥prias obras com a nossa comunidade! Venha fazer parte desse mundo de
                    criatividade e formas surpreendentes!<br> <br> Cadastre-se agora mesmo:</p>
                <button onclick="irParaCadastro()">Cadastrar</button>
            </div>
        </div>
        <div class="com_login" id="com_login">
            <div class="comeco">
                <label>Pesquisar: </label>
                <select name="sel_opcoes" id="sel_opcoes">
                    <option value="todos">Todos</option>
                    <option value="tradicional">Tradicional/Outros</option>
                    <option value="modular">Modular</option>
                    <option value="tessellation">Tessellation</option>
                    <option value="origami3d">Origami 3D</option>
                    <option value="autor">Autor</option>
                </select>
                <div class="pesquisar">
                    <input type="text" id="ipt_pesquisar">
                    <button onclick="pesquisar()" id="btn_pesquisar">üîç</button>
                </div>
            </div>
            <div class="exemplo">
                <img class="comunidade_img" src="./img/1.jpeg" alt="">
                <div class="postagem">
                    <div class="topo_postagem">
                        <div class="texto">
                            <p id="autorOrigami">Autor: Guilherme Aoki</p>
                            <p id="tipoOrigami">Tipo: Origami 3D</p>
                            <p id="nomeOrigami">Nome: 3D Origami Swan</p>
                        </div>
                    </div>
                    <div class="area_comentario">
                        <div class="comentario" id="div_comentario">
                            <p>
                                üí¨ Coment√°rios:
                            </p>
                        </div>
                        <div class="interacao_comentario">
                            <div class="curtir">
                                <button onclick="curtir()" id="btnCurtir"></button>
                            </div>
                            <div class="input_comentario">
                                <input type="text" id="ipt_comentario">
                                <div class="enviar">
                                    <button onclick="comentar()" id="btnComentar"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="exemplo">
                <div class="postagem">
                    <div class="topo_postagem">
                        <div class="texto">
                            <p>Autor: Guilherme Aoki</p>
                            <p>Tipo: Tradicional/Outros</p>
                            <p>Nome: Polygonal Cubes and Stars</p>
                        </div>
                    </div>
                </div>
                <div class="slides">
                    <div class="comunidade_img">
                        <img src="./img/2.jpeg" alt="">
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer_descricao">
            <a href="index.html"><img class="logo" src="./img/logo.png" alt="logo"></a>
            <div class="frase">
                <p>Mundo dos origamis</p>
                <p>Descubra novos origamis</p>
                <p>Compartilhe os seus projetos</p>
            </div>
        </div>
        <div class="footer_fundador">
            <h6>Desenvolvedor</h6>
            <a href="autor.html">Guilherme Aoki Eguchi</a>
        </div>
        <div class="footer_informacao">
            <h6>Mais informa√ß√µes</h6>
            <a href="index.html">Hist√≥ria</a>
            <a href="autor.html">Autor</a>
            <a href="cadastro.html" id="footer_cadastro">Cadastro</a>
            <a href="login.html" id="footer_login">Login</a>
        </div>
        <div class="footer_contato">
            <h6>Contato</h6>
            <p><img src="./img/email.jpg" alt="">guilherme.eguchi@sptech.school</p>
            <p><img src="./img/whatsapp.webp" alt="">(11) 97144-2227</p>
        </div>
    </footer>
</body>

<script>
    var logado = sessionStorage.getItem('logado');
    if (logado == 'logadoSim') {
        sem_login.style.display = 'none';
        com_login.style.display = 'flex';
        navbar_cadastro.style.display = 'none';
        navbar_login.style.display = 'none';
        navbar_sair.style.display = 'flex';
        navbar_quiz.style.display = 'block';
        footer_cadastro.style.display = 'none';
        footer_login.style.display = 'none';
        carregarPosts()
    } else {
        navbar_quiz.style.display = 'none';
    }

    function irParaCadastro() {
        window.location = './cadastro.html';
    }

    document.querySelector('#navbar_sair').onclick = (e) => {
        e.preventDefault();
        sessionStorage.setItem('logado', 'logadoNao');
        window.location.href = './index.html';
    }

    function carregarPosts() {
        fetch('/comunidade/listar', {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        })
            .then(function (resultado) {
                return resultado.json();
            })
            .then(function (posts) {
                var containerPrincipal = document.querySelector('.com_login');

                containerPrincipal.innerHTML = '';

                for (var i = 0; i < posts.length; i++) {
                    var post = posts[i];

                    var divExemplo = document.createElement('div');
                    divExemplo.className = 'exemplo';

                    if (i % 2 == 0){
                        divExemplo.innerHTML = `
                        <img class="comunidade_img" src="./img/${post.id}.jpeg" alt="${post.nome}">
                        <div class="postagem">
                            <div class="topo_postagem">
                                <div class="texto">
                                    <p id="autorOrigami-${post.id}">Autor: ${post.autor}</p>
                                    <p id="tipoOrigami-${post.id}">Tipo: ${post.tipo}</p>
                                    <p id="nomeOrigami-${post.id}">Nome: ${post.nome}</p>
                                </div>
                            </div>
                            <div class="area_comentario">
                                <div class="comentario" id="div_comentario-${post.id}">
                                    <p>üí¨ Coment√°rios:</p>
                                    <b>${post.autor}:</b> ${post.comentario}
                                </div>
                                <div class="interacao_comentario">
                                    <div class="curtir">
                                        <button onclick="curtir(${post.id})" id="btnCurtir-${post.id}"></button>
                                    </div>
                                    <div class="input_comentario">
                                        <input type="text" id="ipt_comentario-${post.id}">
                                        <div class="enviar">
                                            <button onclick="comentar(${post.id})" id="btnComentar-${post.id}">Enviar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    } else {
                        divExemplo.innerHTML = `
                        <div class="postagem">
                            <div class="topo_postagem">
                                <div class="texto">
                                    <p id="autorOrigami-${post.id}">Autor: ${post.autor}</p>
                                    <p id="tipoOrigami-${post.id}">Tipo: ${post.tipo}</p>
                                    <p id="nomeOrigami-${post.id}">Nome: ${post.nome}</p>
                                </div>
                            </div>
                            <div class="area_comentario">
                                <div class="comentario" id="div_comentario-${post.id}">
                                    <p>üí¨ Coment√°rios:</p>
                                    <b>${post.autor}:</b> ${post.comentario}
                                </div>
                                <div class="interacao_comentario">
                                    <div class="curtir">
                                        <button onclick="curtir(${post.id})" id="btnCurtir-${post.id}"></button>
                                    </div>
                                    <div class="input_comentario">
                                        <input type="text" id="ipt_comentario-${post.id}">
                                        <div class="enviar">
                                            <button onclick="comentar(${post.id})" id="btnComentar-${post.id}"></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <img class="comunidade_img" src="./img/${post.id}.jpeg" alt="${post.nome}">
                    `;
                    }

                    containerPrincipal.appendChild(divExemplo);
                }
            })
            .catch(function (error) {
                console.log('Ocorreu um erro:', error);
            });
    }

    function curtir(postId) {
        console.log(`Curtiu o post ${postId}`);
    }

    function comentar(postId) {
        const nomeUsuario = sessionStorage.getItem('NOME_USUARIO')
        const input = document.getElementById(`ipt_comentario-${postId}`);
        const comentario = input.value;

        if (comentario.trim()) {
            console.log(`Coment√°rio no post ${postId}: ${comentario}`);

            const divComentario = document.getElementById(`div_comentario-${postId}`);
            divComentario.innerHTML += ` <br><b>${nomeUsuario}:</b> ${comentario}`;

            input.value = '';
        }
        scrollComentarioNovo();
    }

    function scrollComentarioNovo() {
        const div_comentario = document.getElementById('div_comentario');
        div_comentario.scrollTop = div_comentario.scrollHeight;
    }
</script>

</html>